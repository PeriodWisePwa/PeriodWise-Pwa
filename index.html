<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PeriodWise</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#e91e63">
  <link rel="manifest" href="manifest.json">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 16px;
      text-align: center;
    }

    h1 { color: #e91e63; }

    input, button {
      padding: 10px;
      margin: 6px;
      width: 90%;
      max-width: 320px;
    }

    button {
      background: #e91e63;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-top: 16px;
    }

    .day {
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
    }

    .period { background: #f8bbd0; }
    .high { background: #f44336; color: white; }
    .medium { background: #ffeb3b; }
    .low { background: #c8e6c9; }

    .today {
      border: 2px solid #000;
      font-weight: bold;
    }

    .legend {
      margin-top: 14px;
      font-size: 13px;
    }

    footer {
      margin-top: 20px;
      font-size: 13px;
    }

    #warning {
      color: red;
      font-size: 14px;
    }
  </style>
</head>

<body>

<h1>PeriodWise</h1>
<p>Private ‚Ä¢ Offline ‚Ä¢ No tracking</p>

<div id="inputSection">
  <input id="cycles" placeholder="Last cycles (e.g. 28,29,27,30,28)">
  <input id="periodLength" type="number" placeholder="Period length (default 5)">
  <button onclick="handleSubmit()">Save & Show Calendar</button>
</div>

<p id="warning"></p>

<div id="calendarSection" style="display:none;">
  <div style="margin:10px;">
    <button onclick="changeMonth(-1)">‚óÄ</button>
    <strong id="monthTitle"></strong>
    <button onclick="changeMonth(1)">‚ñ∂</button>
  </div>

  <div class="calendar" id="calendar"></div>

  <div class="legend">
    ü©∑ Period &nbsp; üî¥ High Risk &nbsp; üü° Medium Risk &nbsp; üü¢ Low Risk &nbsp; ‚¨õ Today
  </div>
</div>

<footer>
  <a href="privacy.html">Privacy</a> |
  <a href="disclaimer.html">Disclaimer</a>
</footer>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}

let monthOffset = 0;

function handleSubmit() {
  const cyclesInput = document.getElementById("cycles").value;
  const periodLength = parseInt(document.getElementById("periodLength").value) || 5;
  const cycles = cyclesInput.split(",").map(n => parseInt(n.trim())).filter(Boolean);

  if (cycles.length < 3) {
    document.getElementById("warning").innerText =
      "Please enter at least 3 cycle values.";
    return;
  }

  localStorage.setItem("pw_cycles", JSON.stringify(cycles));
  localStorage.setItem("pw_periodLength", periodLength);

  renderCalendar(cycles, periodLength);
}

function loadSavedData() {
  const cycles = JSON.parse(localStorage.getItem("pw_cycles"));
  const periodLength = parseInt(localStorage.getItem("pw_periodLength"));

  if (cycles && cycles.length >= 3) {
    renderCalendar(cycles, periodLength || 5);
  }
}

function changeMonth(step) {
  monthOffset += step;
  loadSavedData();
}

function renderCalendar(cycles, periodLength) {
  document.getElementById("inputSection").style.display = "none";
  document.getElementById("calendarSection").style.display = "block";

  const calendarEl = document.getElementById("calendar");
  calendarEl.innerHTML = "";
  document.getElementById("warning").innerText = "";

  const avgCycle = cycles.reduce((a,b)=>a+b,0) / cycles.length;

  if (avgCycle < 21 || avgCycle > 40) {
    document.getElementById("warning").innerText =
      "‚ö†Ô∏è Cycle appears irregular. Results are estimates only.";
  }

  const ovulationDay = Math.round(avgCycle - 14);
  const redStart = ovulationDay - 5;
  const redEnd = ovulationDay + 1;
  const yellowStart = redStart - 2;
  const yellowEnd = redEnd + 2;

  const baseDate = new Date();
  baseDate.setMonth(baseDate.getMonth() + monthOffset);

  const year = baseDate.getFullYear();
  const month = baseDate.getMonth();
  const today = new Date();

  const daysInMonth = new Date(year, month + 1, 0).getDate();

  document.getElementById("monthTitle").innerText =
    baseDate.toLocaleString("default", { month: "long", year: "numeric" });

  for (let day = 1; day <= daysInMonth; day++) {
    const el = document.createElement("div");
    el.className = "day";

    if (day <= periodLength) el.classList.add("period");
    else if (day >= redStart && day <= redEnd) el.classList.add("high");
    else if (day >= yellowStart && day <= yellowEnd) el.classList.add("medium");
    else el.classList.add("low");

    if (
      day === today.getDate() &&
      month === today.getMonth() &&
      year === today.getFullYear()
    ) {
      el.classList.add("today");
    }

    el.innerText = day;
    calendarEl.appendChild(el);
  }
}

window.onload = loadSavedData;
</script>

</body>
</html>
